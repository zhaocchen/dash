<!DOCTYPE html>
<html>
<head>
	<title>homework-测试</title>
	<meta charset="utf-8">
	<style type="text/css">
		body{font-family:  theta
			/*Arial,Lucida,Verdana,"宋体","微软雅黑",Helvetica,sans-serif*/;}
	</style>
</head>
<body>
<h1>羽毛球俱乐部收支费用--测试</h1>
<p>输入格式为{活动时间yyyy-MM-dd HH:mm~HH:mm} {人数}</p>
<p>例如：2016-06-02 20:00~22:00 7</p>
<textarea id="input" rows="8" cols="40" placeholder="请在此输入！" wrap="hard"></textarea>
<input type="button" name="button" value="提 交" id="btn">
<p id="summary"></p>
<script type="text/javascript">
	var input=document.getElementById("input"),
		btn=document.getElementById("btn"),
		summary=document.getElementById("summary");
	var strs= new Array(); //定义一数组来储存每一行
	var i;
	var str="[Summary]<br><br>";//用于输出的文本字符串
	var cent,yy,mm,day,weekday,
		start,end,dayprice=0,
		member,t,x,games,
	    income=0,payment=0,profit=0;
	//提交按钮事件
    btn.onclick=function(){   
    	generateSummary(input);	
	}

	//生成总计
function generateSummary(input){
	strs=input.value.split("\n"); //字符分割，一行分割为三个数组
    	for (i=0;i<strs.length ;i++ )
		{	
			dayprice=0;
			cent=parseInt(strs[i].substr(0,2));//世纪
			yy=parseInt(strs[i].substr(2,4));//年份后两位
			mm=parseInt(strs[i].substr(5,2));//月
			day=parseInt(strs[i].substr(8,2));//日
			countWeekday(cent,yy,mm,day);//计算星期几  weekday
			start=parseInt(strs[i].substr(11,2));//开始时间
			end=parseInt(strs[i].substr(17,2));//结束时间
			chargeStandard(weekday,start,end);//每场球一天的日单价dayprice=时间*小时单价
			member=parseInt(strs[i].substr(23));//人数
			countGames(member);//所需要的场地数

			str=str.concat(strs[i]+" 场数："+games);
			str=str.concat("<br> ");//分割后的字符输出
		} 
		str=str.concat("<br>end");
		summary.innerHTML=str;
	
}
//计算星期
function countWeekday(cent,yy,mm,day){
	//蔡勒（Zeller）公式
	//蔡勒（Zeller）公式：w=y+[y/4]+[c/4]-2c+[26(m+1)/10]+d-1
	//w：星期；c：世纪-1；y：年（两位数）；m：月（m大于等于3，小于等于14，即在蔡勒公式中，某年的1、2月要看作上一年的13、14月来计算，比如2003年1月1日要看作2002年的13月1日来计算）；d：日；[ ]代表取整，即只要整数部分。(C是世纪数减一，y是年份后两位，M是月份，d是日数。1月和2月要按上一年的13月和 14月来算，这时C和y均按上一年取值。)
	
	if(mm==1) mm=13;
	else if(mm==2) mm=14;
	weekday=yy+Math.floor(yy/4)+Math.floor(cent/4)-2*cent+Math.floor(26*(mm+1)/10)+day-1;
	weekday=Math.floor(weekday%7);
}
//每块场地的日收费标准
function chargeStandard(weekday,start,end){
	if(weekday>=1&&weekday<=5){
		//周一到周五
		while(start!=end){
			if(start>=9&&start<12){
				dayprice=dayprice+30;
				start=start+1;}
			else if(start>=12&&start<18){
				dayprice=dayprice+50;
				start=start+1;}
			else if(start>=18&&start<20){
				dayprice=dayprice+80;
				start=start+1;}
			else if(start>=20&&start<22){
				dayprice=dayprice+60;
				start=start+1;}
		}		 
	}
	else{
		//周六及周日
		while(start!=end){
			if(start>=9 && start<12){
				dayprice=dayprice+40;
				start=start+1;}
			else if(start>=12&&start<18){
				dayprice=dayprice+50;
				start=start+1;}
			else if(start>=18&&start<22){
				dayprice=dayprice+60;
				start=start+1;}
		}
	}
}
//计算场数
function countGames(member){
	t=Math.floor(member/6),x=Math.floor(member%6);
	if(t==0&&x<4) games=0;
	else if(t==0&&x>=4) games=1;
	else if(t==1) games=2;
	else if((t==2||t==3)&&x<4) games=t;
	else if((t==2||t==3)&&x>=4) games=t+1;
	else games=t;
}
</script>
</body>
</html>
